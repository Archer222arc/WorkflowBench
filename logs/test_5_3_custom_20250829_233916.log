[1;33m[WARNING][0m ⚠️ 未找到conda环境，使用系统Python
[0;34m[INFO][0m === 5.3 缺陷工作流测试脚本启动 ===
[0;34m[INFO][0m 时间戳: 20250829_233916
[0;34m[INFO][0m 日志文件: /Users/ruicheng/Documents/GitHub/WorkflowBench/logs/test_5_3_custom_20250829_233916.log
[0;34m[INFO][0m 检查环境和依赖文件...
[0;32m[SUCCESS][0m 所有必需文件检查完成
[0;34m[INFO][0m 获取用户选择...
[0;34m[INFO][0m 用户选择的缺陷类型: flawed_tool_misuse
[0;34m[INFO][0m 选择开源模型进行测试
[0;34m[INFO][0m 开始执行 5.3 缺陷工作流测试
[0;34m[INFO][0m 缺陷类型数: 1
[0;34m[INFO][0m 测试模型数: 8
[0;34m[INFO][0m 总测试组合: 8
[0;34m[INFO][0m 模型配置: opensource
[0;34m[INFO][0m 并发配置: 50 workers, 10 processes
[0;34m[INFO][0m 存储配置: JSON + ResultCollector
[0;34m[INFO][0m 🚀 开始测试 - 缺陷类型: flawed_tool_misuse
[0;34m[INFO][0m 进度: 1/8 - 测试模型: DeepSeek-V3-0324
[0;34m[INFO][0m 🚀 开始测试 - 模型: DeepSeek-V3-0324, 缺陷类型: flawed_tool_misuse
[0;34m[INFO][0m 执行命令: USE_RESULT_COLLECTOR='true' STORAGE_FORMAT='json' KMP_DUPLICATE_LIB_OK=TRUE python3 ./ultra_parallel_runner.py --model DeepSeek-V3-0324 --prompt-types flawed_tool_misuse --difficulty easy --task-types all --num-instances 20 --rate-mode fixed --max-workers 50
[0;32m[SUCCESS][0m ✅ 模型 DeepSeek-V3-0324 测试完成
[0;34m[INFO][0m 详细日志: /Users/ruicheng/Documents/GitHub/WorkflowBench/logs/ultra_parallel_DeepSeek_V3_0324_flawed_tool_misuse_20250829_233916.log
[0;34m[INFO][0m 日志行数:       69
[0;34m[INFO][0m 等待 3 秒后测试下一个模型...
[0;34m[INFO][0m 进度: 2/8 - 测试模型: DeepSeek-R1-0528
[0;34m[INFO][0m 🚀 开始测试 - 模型: DeepSeek-R1-0528, 缺陷类型: flawed_tool_misuse
[0;34m[INFO][0m 执行命令: USE_RESULT_COLLECTOR='true' STORAGE_FORMAT='json' KMP_DUPLICATE_LIB_OK=TRUE python3 ./ultra_parallel_runner.py --model DeepSeek-R1-0528 --prompt-types flawed_tool_misuse --difficulty easy --task-types all --num-instances 20 --rate-mode fixed --max-workers 50
[0;32m[SUCCESS][0m ✅ 模型 DeepSeek-R1-0528 测试完成
[0;34m[INFO][0m 详细日志: /Users/ruicheng/Documents/GitHub/WorkflowBench/logs/ultra_parallel_DeepSeek_R1_0528_flawed_tool_misuse_20250829_233916.log
[0;34m[INFO][0m 日志行数:       69
[0;34m[INFO][0m 等待 3 秒后测试下一个模型...
[0;34m[INFO][0m 进度: 3/8 - 测试模型: Llama-3.3-70B-Instruct
[0;34m[INFO][0m 🚀 开始测试 - 模型: Llama-3.3-70B-Instruct, 缺陷类型: flawed_tool_misuse
[0;34m[INFO][0m 执行命令: USE_RESULT_COLLECTOR='true' STORAGE_FORMAT='json' KMP_DUPLICATE_LIB_OK=TRUE python3 ./ultra_parallel_runner.py --model Llama-3.3-70B-Instruct --prompt-types flawed_tool_misuse --difficulty easy --task-types all --num-instances 20 --rate-mode fixed --max-workers 50
[0;31m[ERROR][0m ❌ 模型 Llama-3.3-70B-Instruct 测试失败 (退出码: 137)
[0;31m[ERROR][0m 检查日志: /Users/ruicheng/Documents/GitHub/WorkflowBench/logs/ultra_parallel_Llama_3_3_70B_Instruct_flawed_tool_misuse_20250829_233916.log
[0;31m[ERROR][0m === 最后50行日志内容 ===
[0;31m[ERROR][0m   2025-08-29 23:39:37,147 - batch_test_runner - INFO - Detected Azure API, disabling QPS sleep for better performance
[0;31m[ERROR][0m   2025-08-29 23:39:37,147 - batch_test_runner - INFO - Starting batch test with 1 tasks, 50 workers
[0;31m[ERROR][0m   2025-08-29 23:39:37,147 - batch_test_runner - INFO - Each task timeout: 10 minutes, Total batch timeout: 20 minutes
[0;31m[ERROR][0m   2025-08-29 23:39:37,147 - batch_test_runner - INFO - Batch timeout set to 3600s (60.0 minutes) for 1 tasks
[0;31m[ERROR][0m   2025-08-29 23:39:37,150 - smart_model_router - INFO - ✨ Using USER's Azure endpoint for Llama-3.3-70B-Instruct
[0;31m[ERROR][0m   2025-08-29 23:39:37,150 - api_client_manager - WARNING - Model Llama-3.3-70B-Instruct not in SUPPORTED_MODELS, attempting anyway
[0;31m[ERROR][0m   2025-08-29 23:39:37,157 - mcp_embedding_manager - INFO - Loading index from .mcp_embedding_cache/tool_index.pkl (size: 3723608 bytes)
[0;31m[ERROR][0m   2025-08-29 23:39:37,180 - mcp_embedding_manager - INFO - FAISS index loaded
[0;31m[ERROR][0m   2025-08-29 23:39:37,180 - mcp_embedding_manager - INFO - Updated dimension to 3072
[0;31m[ERROR][0m   2025-08-29 23:39:37,180 - mcp_embedding_manager - INFO - Index loaded successfully: 30 tools
[0;31m[ERROR][0m   2025-08-29 23:39:38,244 - httpx - INFO - HTTP Request: POST https://85409-me3ofvov-eastus2.services.ai.azure.com/openai/deployments/Llama-3.3-70B-Instruct/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
[0;31m[ERROR][0m   2025-08-29 23:39:38,788 - httpx - INFO - HTTP Request: POST https://85409-me3ofvov-eastus2.services.ai.azure.com/openai/deployments/Llama-3.3-70B-Instruct/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
[0;31m[ERROR][0m   2025-08-29 23:39:39,342 - httpx - INFO - HTTP Request: POST https://85409-me3ofvov-eastus2.services.ai.azure.com/openai/deployments/Llama-3.3-70B-Instruct/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
[0;31m[ERROR][0m   2025-08-29 23:39:40,004 - httpx - INFO - HTTP Request: POST https://85409-me3ofvov-eastus2.services.ai.azure.com/openai/deployments/Llama-3.3-70B-Instruct/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
[0;31m[ERROR][0m   2025-08-29 23:39:40,866 - httpx - INFO - HTTP Request: POST https://85409-me3ofvov-eastus2.services.ai.azure.com/openai/deployments/Llama-3.3-70B-Instruct/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
[0;31m[ERROR][0m   2025-08-29 23:39:42,146 - httpx - INFO - HTTP Request: POST https://85409-me3ofvov-eastus2.services.ai.azure.com/openai/deployments/Llama-3.3-70B-Instruct/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
[0;31m[ERROR][0m   2025-08-29 23:39:43,161 - httpx - INFO - HTTP Request: POST https://85409-me3ofvov-eastus2.services.ai.azure.com/openai/deployments/Llama-3.3-70B-Instruct/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
[0;31m[ERROR][0m   2025-08-29 23:39:44,087 - httpx - INFO - HTTP Request: POST https://85409-me3ofvov-eastus2.services.ai.azure.com/openai/deployments/Llama-3.3-70B-Instruct/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
[0;31m[ERROR][0m   2025-08-29 23:39:45,271 - httpx - INFO - HTTP Request: POST https://85409-me3ofvov-eastus2.services.ai.azure.com/openai/deployments/Llama-3.3-70B-Instruct/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
[0;31m[ERROR][0m   2025-08-29 23:39:45,713 - httpx - INFO - HTTP Request: POST https://85409-me3ofvov-eastus2.services.ai.azure.com/openai/deployments/Llama-3.3-70B-Instruct/chat/completions?api-version=2024-02-15-preview "HTTP/1.1 200 OK"
[0;31m[ERROR][0m   2025-08-29 23:39:57,821 - httpx - INFO - HTTP Request: POST https://85409-me3ofvov-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-5-nano/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
[0;31m[ERROR][0m   2025-08-29 23:39:57,823 - result_collector - INFO - 📤 已提交 Llama-3.3-70B-Instruct 的 1 个结果到收集器: Llama-3.3-70B-Instruct_38774_1756525197823318.json
[0;31m[ERROR][0m   2025-08-29 23:39:57,823 - batch_test_runner - INFO - Batch writing 1 records to database (Llama-3.3-70B-Instruct:1)
[0;31m[ERROR][0m   2025-08-29 23:39:57,824 - result_collector - INFO - 📤 已提交 Llama-3.3-70B-Instruct 的 1 个结果到收集器: Llama-3.3-70B-Instruct_38774_1756525197824055.json
[0;31m[ERROR][0m   2025-08-29 23:39:57,824 - batch_test_runner - INFO - Successfully wrote 1/1 records (Llama-3.3-70B-Instruct:1)
[0;31m[ERROR][0m   2025-08-29 23:39:57,847 - batch_test_runner - INFO - Database saved successfully
[0;31m[ERROR][0m   2025-08-29 23:39:57,847 - batch_test_runner - INFO - Statistics saved to: /Users/ruicheng/Documents/GitHub/WorkflowBench/pilot_bench_cumulative_results/master_database.json
[0;31m[ERROR][0m   2025-08-29 23:39:57,848 - batch_test_runner - INFO - ============================================================
[0;31m[ERROR][0m   2025-08-29 23:39:57,848 - batch_test_runner - INFO - Batch test completed at 2025-08-29T23:39:57.848112
[0;31m[ERROR][0m   2025-08-29 23:39:57,848 - batch_test_runner - INFO - Summary:
[0;31m[ERROR][0m   2025-08-29 23:39:57,848 - batch_test_runner - INFO -   - Total tests: 1
[0;31m[ERROR][0m   2025-08-29 23:39:57,848 - batch_test_runner - INFO -   - Successful: 1
[0;31m[ERROR][0m   2025-08-29 23:39:57,848 - batch_test_runner - INFO -   - Failed: 0
[0;31m[ERROR][0m   2025-08-29 23:39:57,848 - batch_test_runner - INFO -   - Success rate: 100.0%
[0;31m[ERROR][0m   2025-08-29 23:39:57,848 - batch_test_runner - INFO -   - Log file: logs/batch_test_20250829_233930.log
[0;31m[ERROR][0m   2025-08-29 23:39:57,848 - batch_test_runner - INFO - ============================================================
[0;31m[ERROR][0m   2025-08-29 23:39:57,848 - batch_test_runner - INFO - 🧹 正在清理存储适配器资源...
[0;31m[ERROR][0m   2025-08-29 23:39:57,848 - result_merger - INFO - 合并线程已经停止，无需重复操作
[0;31m[ERROR][0m   2025-08-29 23:39:57,848 - result_merger - INFO - 发现2个新的结果文件
[0;31m[ERROR][0m   2025-08-29 23:39:57,867 - focused_ai_classifier - INFO - Focused AI classifier initialized with gpt-5-nano (parameter-filtered)
[0;31m[ERROR][0m   2025-08-29 23:39:57,867 - result_merger - INFO - [MERGER_PROTECTION] 使用manager内置的安全合并机制
[0;31m[ERROR][0m   2025-08-29 23:40:09,076 - httpx - INFO - HTTP Request: POST https://85409-me3ofvov-eastus2.cognitiveservices.azure.com/openai/deployments/gpt-5-nano/chat/completions?api-version=2024-12-01-preview "HTTP/1.1 200 OK"
[0;31m[ERROR][0m   2025-08-29 23:40:09,076 - focused_ai_classifier - INFO - Raw AI response (first 200 chars): {
[0;31m[ERROR][0m     "category": "other_errors",
[0;31m[ERROR][0m     "reason": "There is no clear agent decision error evident: tool execution results are reported as 'Unknown' with 0% coverage and no concrete tool outcomes to evaluate
[0;31m[ERROR][0m   2025-08-29 23:40:09,076 - result_merger - INFO - 模型Llama-3.3-70B-Instruct保存2/2条记录
[0;31m[ERROR][0m   2025-08-29 23:40:09,077 - result_merger - INFO - 合并完成，共处理2个文件，保存2条记录
[0;31m[ERROR][0m   2025-08-29 23:40:09,077 - batch_test_runner - INFO - ✅ 存储适配器资源清理完成
[0;31m[ERROR][0m   === 测试结束时间: 2025年 8月29日 星期五 23时47分52秒 EDT ===
[0;31m[ERROR][0m   === 退出码: 137 ===
[0;31m[ERROR][0m === 日志结束 ===
[0;34m[INFO][0m 等待 3 秒后测试下一个模型...
[0;34m[INFO][0m 进度: 4/8 - 测试模型: qwen2.5-72b-instruct
[0;34m[INFO][0m 🚀 开始测试 - 模型: qwen2.5-72b-instruct, 缺陷类型: flawed_tool_misuse
[0;34m[INFO][0m 执行命令: USE_RESULT_COLLECTOR='true' STORAGE_FORMAT='json' KMP_DUPLICATE_LIB_OK=TRUE python3 ./ultra_parallel_runner.py --model qwen2.5-72b-instruct --prompt-types flawed_tool_misuse --difficulty easy --task-types all --num-instances 20 --rate-mode fixed --max-workers 1
[1;33m[WARNING][0m 接收到中断信号，正在清理...
[0;34m[INFO][0m 清理完成
